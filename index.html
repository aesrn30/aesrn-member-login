<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>African Emerging Scholars Research Network (AESRN) | Work Submission System</title>
    <link rel="icon" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-32x32.png" type="image/png">
    <link itemprop="image" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-32x32.png">
    <meta property="og:logo" content="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-32x32.png">
    <meta name="twitter:logo" content="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-32x32.png">

    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/favicon-16x16.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/aesrn30/aesrn/main/site.webmanifest">
    <script async src="https://tally.so/widgets/embed.js"></script>
    <style type="text/css">
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html { 
        margin: 0; 
        height: 100%; 
        overflow: hidden; 
      }
      
      iframe { 
        position: absolute; 
        top: 0; 
        right: 0; 
        bottom: 0; 
        left: 0; 
        border: 0; 
      }
      
      body { 
        margin: 0; 
        height: 100vh; 
        display: flex; 
        flex-direction: column; 
        font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        transition: background-color 0.3s ease, color 0.3s ease;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Professional login form styling */
      .login-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 30px;
        background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        min-height: 100vh;
        width: 100%;
      }
      
      .login-box {
        background: white;
        border-radius: 16px;
        padding: 50px;
        width: 100%;
        max-width: 480px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }
      
      .login-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
      }
      
      .login-header {
        text-align: center;
        margin-bottom: 40px;
      }
      
      .login-logo-circle {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px auto;
        border-radius: 50%;
        overflow: hidden;
        background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        border: 3px solid white;
        box-shadow: 0 6px 20px rgba(26, 35, 126, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .login-logo-circle:hover {
        transform: scale(1.04);
        box-shadow: 0 8px 25px rgba(26, 35, 126, 0.35);
      }
      
      .logo-circle-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      
      .login-title {
        font-size: 28px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
      }
      
      .login-subtitle {
        color: #666;
        font-size: 15px;
        line-height: 1.6;
        max-width: 300px;
        margin: 0 auto;
        opacity: 0.9;
      }
      
      .form-group {
        margin-bottom: 28px;
      }
      
      .form-label {
        display: block;
        margin-bottom: 10px;
        color: #2c3e50;
        font-weight: 600;
        font-size: 14px;
        letter-spacing: 0.3px;
      }
      
      .form-input {
        width: 100%;
        padding: 16px 18px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: #f8f9fa;
        color: #333;
        font-weight: 500;
      }
      
      .form-input:focus {
        outline: none;
        border-color: #1a237e;
        background: white;
        box-shadow: 0 0 0 4px rgba(26, 35, 126, 0.15);
        transform: translateY(-1px);
      }
      
      .form-input::placeholder {
        color: #999;
        font-weight: 400;
      }
      
      .login-button {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 15px;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        position: relative;
        overflow: hidden;
      }
      
      .login-button::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
      }
      
      .login-button:hover::after {
        left: 100%;
      }
      
      .login-button:hover {
        background: linear-gradient(135deg, #0d155e 0%, #1c236d 100%);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(26, 35, 126, 0.3);
      }
      
      .login-button:active {
        transform: translateY(0);
      }
      
      /* Error states */
      .error-message {
        color: #d32f2f;
        font-size: 13px;
        margin-top: 12px;
        text-align: center;
        display: none;
        padding: 15px;
        background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
        border-radius: 8px;
        border-left: 4px solid #d32f2f;
        font-weight: 500;
      }
      
      .attempts-warning {
        color: #f57c00;
        font-size: 13px;
        margin-top: 10px;
        text-align: center;
        display: none;
        padding: 12px;
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        border-radius: 8px;
        border-left: 4px solid #f57c00;
        font-weight: 500;
      }
      
      /* Form container */
      .form-container {
        flex: 1;
        position: relative;
        display: none;
        width: 100%;
        min-height: calc(100vh - 80px);
      }
      
      /* Footer styling - Minimal */
      .footer {
        background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        padding: 15px 30px;
        color: #ecf0f1;
        font-size: 14px;
        line-height: 1.4;
        z-index: 10;
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        min-height: 80px;
        box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .footer-left {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }
      
      .footer-right {
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }
      
      .user-name {
        color: #3498db;
        font-weight: 600;
        font-size: 15px;
      }
      
      .logout-button {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 18px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }
      
      .logout-button:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }
      
      .footer-email {
        color: #3498db;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      .footer-email:hover {
        color: #2980b9;
        text-decoration: underline;
      }
      
      .ghana-time-container {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .ghana-time-display {
        font-family: 'Courier New', monospace;
        font-size: 14px;
        font-weight: 700;
        color: #2ecc71;
        background: rgba(0, 0, 0, 0.2);
        padding: 4px 10px;
        border-radius: 4px;
        min-width: 85px;
        text-align: center;
      }
      
      .footer-copyright {
        width: 100%;
        text-align: center;
        font-size: 12px;
        opacity: 0.8;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-weight: 300;
      }
      
      /* Remove "Made with Tally" text */
      .footer-copyright a {
        display: none !important;
      }
      
      /* Login Greeting Notification */
      .login-greeting-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        color: white;
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 2000;
        display: none;
        align-items: center;
        gap: 15px;
        animation: slideInRight 0.5s ease;
        max-width: 350px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }
      
      .greeting-icon {
        font-size: 24px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        flex-shrink: 0;
      }
      
      .greeting-content h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
        font-weight: 700;
      }
      
      .greeting-content p {
        margin: 0;
        font-size: 13px;
        opacity: 0.9;
        font-weight: 500;
      }
      
      @keyframes slideInRight {
        from {
          transform: translateX(100%) translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateX(0) translateY(0);
          opacity: 1;
        }
      }
      
      @keyframes fadeOutUp {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(-20px);
          opacity: 0;
        }
      }
      
      /* Logout notification */
      .logout-notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        color: white;
        padding: 30px 40px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        z-index: 3000;
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        min-width: 300px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }
      
      .logout-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      .logout-message {
        font-size: 18px;
        font-weight: 600;
        color: #ecf0f1;
      }
      
      .logout-countdown {
        font-size: 14px;
        color: #bdc3c7;
        margin-top: 10px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Loading overlay */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 100;
        backdrop-filter: blur(5px);
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1a237e;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      
      .loading-text {
        font-size: 16px;
        color: #666;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      
      /* Confirmation dialog */
      .confirmation-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
      }
      
      .confirmation-dialog {
        background: white;
        border-radius: 16px;
        padding: 40px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        animation: modalFadeIn 0.3s ease;
        text-align: center;
      }
      
      .confirmation-icon {
        font-size: 48px;
        margin-bottom: 20px;
        color: #e74c3c;
      }
      
      .confirmation-title {
        font-size: 22px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 15px;
      }
      
      .confirmation-message {
        color: #666;
        line-height: 1.6;
        margin-bottom: 30px;
        font-size: 15px;
      }
      
      .confirmation-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
      }
      
      .confirm-button {
        flex: 1;
        padding: 14px 24px;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .confirm-yes {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }
      
      .confirm-yes:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
      }
      
      .confirm-no {
        background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
        color: #2c3e50;
        border: 1px solid #ddd;
      }
      
      .confirm-no:hover {
        background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
        transform: translateY(-1px);
      }
      
      /* Inactivity Warning */
      .inactivity-warning {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        color: white;
        border-radius: 16px;
        padding: 30px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        z-index: 4000;
        text-align: center;
        animation: modalFadeIn 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }
      
      .inactivity-timer {
        font-size: 36px;
        font-weight: 700;
        color: #e74c3c;
        margin: 20px 0;
        font-family: monospace;
      }
      
      .inactivity-message {
        margin: 15px 0;
        color: #ecf0f1;
        line-height: 1.5;
      }
      
      .keep-active-button {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
      }
      
      .keep-active-button:hover {
        background: linear-gradient(135deg, #2980b9 0%, #1f618d 100%);
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
      }
      
      @keyframes modalFadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      /* Mobile Logout Button Styles - FIXED FOR CLICKABILITY */
      .mobile-logout-button {
        position: fixed;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 20px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 2000; /* Increased z-index */
        display: none;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        pointer-events: auto; /* Ensure button is clickable */
      }
      
      .mobile-logout-button:hover {
        background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }
      
      .mobile-logout-button:active {
        transform: translateY(0);
      }
      
      .mobile-logout-button .mobile-user-name {
        display: none;
        margin-right: 8px;
        font-weight: 500;
      }
      
      /* Mobile Header Info - FIXED FOR CLICKABILITY */
      .mobile-header-info {
        position: fixed;
        top: 15px;
        left: 15px;
        background: rgba(26, 35, 126, 0.95);
        color: white;
        border-radius: 50px;
        padding: 10px 18px;
        font-size: 13px;
        font-weight: 600;
        z-index: 2000; /* Increased z-index */
        display: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        pointer-events: auto; /* Ensure info is clickable */
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      /* Mobile Back to Top Button - FIXED FOR CLICKABILITY */
      .mobile-top-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 22px;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 2000; /* Increased z-index */
        display: none;
        box-shadow: 0 4px 15px rgba(26, 35, 126, 0.3);
        justify-content: center;
        align-items: center;
        pointer-events: auto; /* Ensure button is clickable */
      }
      
      .mobile-top-button:hover {
        background: linear-gradient(135deg, #0d155e 0%, #1c236d 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(26, 35, 126, 0.4);
      }
      
      /* Responsive design */
      @media (max-width: 768px) {
        .login-container {
          padding: 20px;
        }
        
        .login-box {
          padding: 30px;
          max-width: 100%;
          margin: 0 15px;
        }
        
        .login-title {
          font-size: 24px;
        }
        
        .login-logo-circle {
          width: 110px;
          height: 110px;
          margin-bottom: 25px;
        }
        
        .footer {
          padding: 15px;
          flex-direction: column;
          text-align: center;
          gap: 15px;
          min-height: auto;
        }
        
        .footer-left, .footer-right {
          width: 100%;
          justify-content: center;
          flex-direction: column;
          gap: 15px;
        }
        
        .confirmation-dialog {
          padding: 30px 20px;
          width: 95%;
        }
        
        .logout-notification {
          min-width: 250px;
          padding: 25px;
        }
        
        .login-greeting-notification {
          top: 10px;
          right: 10px;
          left: 10px;
          max-width: none;
          padding: 15px 20px;
        }
        
        .inactivity-warning {
          width: 95%;
          padding: 25px;
        }
        
        /* Show mobile logout button and hide footer on mobile */
        .mobile-logout-button {
          display: block;
        }
        
        .mobile-header-info {
          display: block;
        }
        
        .mobile-top-button {
          display: flex;
        }
        
        /* Hide footer on mobile since we have the mobile buttons */
        .footer {
          display: none !important;
        }
        
        /* Adjust form container for mobile */
        .form-container {
          min-height: 100vh;
        }
        
        /* Adjust iframe for mobile - IMPORTANT: Add padding for mobile buttons */
        #formIframe {
          top: 0;
          height: 100vh;
          padding-top: 70px; /* Space for mobile header buttons */
          padding-bottom: 80px; /* Space for mobile footer buttons */
        }
        
        /* Ensure form container has proper positioning */
        .form-container {
          position: relative;
          overflow: hidden;
        }
      }
      
      @media (max-width: 480px) {
        .login-box {
          padding: 25px;
        }
        
        .login-title {
          font-size: 22px;
        }
        
        .login-logo-circle {
          width: 95px;
          height: 95px;
          margin-bottom: 20px;
        }
        
        .form-input {
          padding: 14px 16px;
        }
        
        .login-button {
          padding: 16px;
        }
        
        .confirmation-buttons {
          flex-direction: column;
        }
        
        .confirm-button {
          width: 100%;
        }
        
        .mobile-logout-button {
          padding: 10px 16px;
          font-size: 12px;
          top: 10px;
          right: 10px;
        }
        
        .mobile-header-info {
          padding: 8px 14px;
          font-size: 12px;
          top: 10px;
          left: 10px;
          max-width: 150px;
        }
        
        .mobile-top-button {
          width: 45px;
          height: 45px;
          font-size: 20px;
          bottom: 15px;
          right: 15px;
        }
        
        /* Adjust iframe padding for smaller screens */
        #formIframe {
          padding-top: 60px;
          padding-bottom: 70px;
        }
      }
      
      /* Ensure form iframe is properly sized */
      #formIframe {
        width: 100%;
        height: 100%;
        display: block;
      }
      
      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }
      
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      
      ::-webkit-scrollbar-thumb {
        background: #1a237e;
        border-radius: 4px;
      }
      
      ::-webkit-scrollbar-thumb:hover {
        background: #283593;
      }
      
      /* For Firefox */
      * {
        scrollbar-width: thin;
        scrollbar-color: #1a237e #f1f1f1;
      }
    </style>
  </head>
  <body>
      <!-- Login Container -->
    <div class="login-container" id="loginContainer">
      <div class="login-box">
        <div class="login-header">
          <div class="login-logo-circle">
            <img src="https://raw.githubusercontent.com/aesrn30/aesrn/main/Lablogo.png" 
                 alt="AESRN Logo" 
                 class="logo-circle-image"
                 id="logoCircleImage">
          </div>
          
          <div class="login-title">Member Access Portal</div>
          <div class="login-subtitle">
Enter your login credentials to access the Research Network form and submit your assigned section.
          </div>
        </div>
        
        <form id="loginForm">
          <div class="form-group">
            <label class="form-label" for="email">Email Address</label>
            <input 
              type="email" 
              id="email" 
              class="form-input" 
              placeholder="Enter registered email address"
              required
              autocomplete="off"
            >
          </div>
          
          <div class="form-group">
            <label class="form-label" for="password">Access Password</label>
            <input 
              type="password" 
              id="password" 
              class="form-input" 
              placeholder="Enter access password"
              required
              autocomplete="off"
            >
          </div>
          
          <button type="submit" class="login-button" id="loginButton">Login</button>
          
          <!-- Copyright notice added here -->
          <div style="text-align: center; margin-top: 20px; font-size: 11px; color: #555; font-weight: 400;">
            Copyright ¬© 2026 AERSN. All rights reserved.
          </div>
          
          <div class="error-message" id="errorMessage">
            Invalid credentials. Please check your email and password.
          </div>
          
          <div class="attempts-warning" id="attemptsWarning">
            Multiple failed attempts may temporarily restrict access.
          </div>
        </form>
      </div>
    </div>
    
    <!-- Form Container -->
    <div class="form-container" id="formContainer">
      <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading form...</div>
      </div>
      
      <!-- Mobile Header Info -->
      <div class="mobile-header-info" id="mobileHeaderInfo">
        <span id="mobileUserName"></span>
      </div>
      
      <!-- Mobile Logout Button -->
      <button class="mobile-logout-button" id="mobileLogoutButton">
        <span class="mobile-user-name" id="mobileUserNameShort"></span>
        Logout
      </button>
      
      <!-- Mobile Back to Top Button -->
      <button class="mobile-top-button" id="mobileTopButton">
        ‚Üë
      </button>
      
      <iframe 
        data-tally-src="https://tally.so/r/dWd6gA?transparentBackground=1&formEventsForwarding=1" 
        width="100%" 
        height="100%" 
        frameborder="0" 
        marginheight="0" 
        marginwidth="0" 
        title="African Emerging Scholars Research Network (AESRN)"
        id="formIframe"
        style="visibility: hidden;"
        onload="hideLoading()"
      ></iframe>
    </div>
    
    <!-- Footer -->
    <footer class="footer" style="display: none;" id="siteFooter">
      <div class="footer-left">
        <div>
          Logged in as: <span class="user-name" id="userNameDisplay"></span>
        </div>
        <button class="logout-button" id="logoutButton">Logout</button>
      </div>
      <div class="footer-right">
        <div>
          Email: <a href="mailto:research.aesrn@yahoo.com" class="footer-email">research.aesrn@yahoo.com</a>
        </div>
        <div class="ghana-time-container">
          <div class="ghana-flag">üá¨üá≠</div>
          <div class="ghana-time-display" id="ghanaTimeDisplay">--:--:--</div>
          <div class="ghana-timezone">GMT</div>
        </div>
      </div>
      <div class="footer-copyright">
        Copyright ¬© <span id="copyrightYear"></span> African Emerging Scholars Research Network (AESRN). All rights reserved.
      </div>
    </footer>
    
    <!-- Login Greeting Notification -->
    <div class="login-greeting-notification" id="loginGreeting">
      <div class="greeting-icon" id="greetingIcon">üëã</div>
      <div class="greeting-content">
        <h4 id="greetingText">Good Morning</h4>
        <p id="userGreeting">Welcome back!</p>
      </div>
    </div>
    
    <!-- Logout Notification -->
    <div class="logout-notification" id="logoutNotification">
      <div class="logout-spinner"></div>
      <div class="logout-message">Logged out successfully!</div>
      <div class="logout-countdown">Redirecting to login page in <span id="logoutCountdown">5</span> seconds...</div>
    </div>
    
    <!-- Inactivity Warning -->
    <div class="inactivity-warning" id="inactivityWarning">
      <h3>Session Timeout Warning</h3>
      <div class="inactivity-timer" id="inactivityTimer">2:00</div>
      <p class="inactivity-message">
        You've been inactive for a while. Your session will expire in 2 minutes.<br>
        Click the button below to remain logged in.
      </p>
      <button class="keep-active-button" id="keepActiveButton">Keep Me Logged In</button>
    </div>
    
    <!-- Confirmation Dialog -->
    <div class="confirmation-overlay" id="confirmationDialog">
      <div class="confirmation-dialog">
        <div class="confirmation-icon">‚ö†Ô∏è</div>
        <div class="confirmation-title">Confirm Logout</div>
        <div class="confirmation-message">
          Are you sure you want to log out?<br>
          Any unsaved changes in the form may be lost.
        </div>
        <div class="confirmation-buttons">
          <button class="confirm-button confirm-yes" id="confirmLogout">Yes, Logout</button>
          <button class="confirm-button confirm-no" id="cancelLogout">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      // List of allowed email addresses with names
      const userMap = {
        "malikseidu4@gmail.com": "Abdul-Malik",
        "Malikseidu4@gmail.com": "Abdul-Malik",
        "abdul0247080685@gmail.com": "Abdul Latif",
        "Abdul0247080685@gmail.com": "Abdul Latif",
        "ednadie93@gmail.com": "Edna",
        "Ednadie93@gmail.com": "Edna",
        "issahaqalhassan26@gmail.com": "Alhassan",
        "Issahaqalhassan26@gmail.com": "Alhassan",
        "mudassiribrahim30@gmail.com": "Mudasir",
        "Mudassiribrahim30@gmail.com": "Mudasir"
      };
      
      // Correct password
      const correctPassword = "Scholar123";
      
      // Track failed attempts
      let failedAttempts = 0;
      const maxAttempts = 5;
      
      // Store current user info
      let currentUserName = "";
      let currentUserEmail = "";
      
      // Ghana time update interval
      let ghanaTimeInterval;
      
      // Session management
      const SESSION_TIMEOUT = 2 * 60 * 1000; // 2 minutes
      const WARNING_TIME = 1 * 60 * 1000; // Show warning after 1 minute
      let inactivityTimer;
      let warningTimer;
      let lastActivityTime;
      
      // Session tracking for single login per user
      const ACTIVE_SESSIONS_KEY = 'aesrn_active_sessions';
      const CURRENT_SESSION_KEY = 'aesrn_current_session';
      const USER_SESSION_KEY = 'aesrn_user_session';
      const SHOWN_GREETING_KEY = 'aesrn_shown_greeting';
      
      // Function to generate unique session ID
      function generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }
      
      // Function to get current session ID
      function getCurrentSessionId() {
        return sessionStorage.getItem(CURRENT_SESSION_KEY);
      }
      
      // Function to set current session ID
      function setCurrentSessionId(sessionId) {
        sessionStorage.setItem(CURRENT_SESSION_KEY, sessionId);
      }
      
      // Function to get active sessions
      function getActiveSessions() {
        const sessions = localStorage.getItem(ACTIVE_SESSIONS_KEY);
        return sessions ? JSON.parse(sessions) : {};
      }
      
      // Function to save active sessions
      function saveActiveSessions(sessions) {
        localStorage.setItem(ACTIVE_SESSIONS_KEY, JSON.stringify(sessions));
      }
      
      // Function to check if greeting has been shown for this session
      function hasGreetingBeenShown(sessionId) {
        const shownGreetings = JSON.parse(localStorage.getItem(SHOWN_GREETING_KEY) || '{}');
        return shownGreetings[sessionId] || false;
      }
      
      // Function to mark greeting as shown for this session
      function markGreetingAsShown(sessionId) {
        const shownGreetings = JSON.parse(localStorage.getItem(SHOWN_GREETING_KEY) || '{}');
        shownGreetings[sessionId] = true;
        localStorage.setItem(SHOWN_GREETING_KEY, JSON.stringify(shownGreetings));
      }
      
      // Function to clear greeting status for a session (on logout)
      function clearGreetingStatus(sessionId) {
        const shownGreetings = JSON.parse(localStorage.getItem(SHOWN_GREETING_KEY) || '{}');
        delete shownGreetings[sessionId];
        localStorage.setItem(SHOWN_GREETING_KEY, JSON.stringify(shownGreetings));
      }
      
      // Function to check if user is already logged in elsewhere
      function isUserAlreadyLoggedIn(email) {
        const sessions = getActiveSessions();
        const userSession = sessions[email];
        
        if (!userSession) return false;
        
        // Check if session is expired
        if (Date.now() > userSession.expiry) {
          delete sessions[email];
          saveActiveSessions(sessions);
          return false;
        }
        
        // Check if this is the same session (same browser/device)
        const currentSessionId = getCurrentSessionId();
        if (userSession.sessionId === currentSessionId) {
          return false; // Same session, not logged in elsewhere
        }
        
        return true; // User is logged in elsewhere
      }
      
      // Function to register user session
      function registerUserSession(email, name) {
        const sessionId = generateSessionId();
        const sessions = getActiveSessions();
        
        // Remove any existing session for this user
        if (sessions[email]) {
          // Clear greeting status for old session
          clearGreetingStatus(sessions[email].sessionId);
          delete sessions[email];
        }
        
        // Add new session
        sessions[email] = {
          sessionId: sessionId,
          expiry: Date.now() + SESSION_TIMEOUT,
          name: name,
          loginTime: Date.now(),
          isFirstLogin: true
        };
        
        saveActiveSessions(sessions);
        setCurrentSessionId(sessionId);
        
        // Save user session data
        const userSession = {
          email: email,
          name: name,
          sessionId: sessionId,
          loginTime: Date.now(),
          expiry: Date.now() + SESSION_TIMEOUT,
          isFirstLogin: true
        };
        
        localStorage.setItem(USER_SESSION_KEY, JSON.stringify(userSession));
        
        return sessionId;
      }
      
      // Function to update session expiry
      function updateSessionExpiry() {
        const sessions = getActiveSessions();
        const userSession = JSON.parse(localStorage.getItem(USER_SESSION_KEY) || '{}');
        
        if (userSession.email && sessions[userSession.email]) {
          sessions[userSession.email].expiry = Date.now() + SESSION_TIMEOUT;
          saveActiveSessions(sessions);
          
          // Update user session expiry
          userSession.expiry = Date.now() + SESSION_TIMEOUT;
          localStorage.setItem(USER_SESSION_KEY, JSON.stringify(userSession));
        }
      }
      
      // Function to remove user session
      function removeUserSession(email) {
        const sessions = getActiveSessions();
        if (sessions[email]) {
          // Clear greeting status for this session
          clearGreetingStatus(sessions[email].sessionId);
          delete sessions[email];
          saveActiveSessions(sessions);
        }
        
        // Clear user session data
        localStorage.removeItem(USER_SESSION_KEY);
        sessionStorage.removeItem(CURRENT_SESSION_KEY);
      }
      
      // Function to get greeting based on time
      function getGreeting() {
        const now = new Date();
        const hour = now.getHours();
        
        if (hour < 12) {
          return "Good Morning";
        } else if (hour < 17) {
          return "Good Afternoon";
        } else {
          return "Good Evening";
        }
      }
      
      // Function to get greeting icon
      function getGreetingIcon() {
        const now = new Date();
        const hour = now.getHours();
        
        if (hour < 12) {
          return "üåÖ";
        } else if (hour < 17) {
          return "‚òÄÔ∏è";
        } else {
          return "üåô";
        }
      }
      
      // Function to show login greeting (only on first login)
      function showLoginGreeting() {
        const sessionId = getCurrentSessionId();
        
        // Check if greeting has already been shown for this session
        if (hasGreetingBeenShown(sessionId)) {
          console.log('Greeting already shown for this session, skipping...');
          return;
        }
        
        const greeting = getGreeting();
        const icon = getGreetingIcon();
        
        document.getElementById('greetingText').textContent = greeting;
        document.getElementById('greetingIcon').textContent = icon;
        document.getElementById('userGreeting').textContent = `${greeting}, ${currentUserName}!`;
        
        const notification = document.getElementById('loginGreeting');
        notification.style.display = 'flex';
        
        // Mark greeting as shown for this session
        markGreetingAsShown(sessionId);
        
        // Hide after 5 seconds
        setTimeout(() => {
          notification.style.animation = 'fadeOutUp 0.5s ease';
          setTimeout(() => {
            notification.style.display = 'none';
            notification.style.animation = 'slideInRight 0.5s ease';
          }, 500);
        }, 5000);
      }
      
      // Function to hide loading overlay
      function hideLoading() {
        const loadingOverlay = document.getElementById('loadingOverlay');
        const iframe = document.getElementById('formIframe');
        
        if (loadingOverlay) {
          loadingOverlay.style.opacity = '0';
          setTimeout(() => {
            loadingOverlay.style.display = 'none';
            if (iframe) {
              iframe.style.visibility = 'visible';
            }
          }, 300);
        }
      }
      
      // Function to show loading overlay
      function showLoading() {
        const loadingOverlay = document.getElementById('loadingOverlay');
        const iframe = document.getElementById('formIframe');
        
        if (loadingOverlay) {
          loadingOverlay.style.display = 'flex';
          loadingOverlay.style.opacity = '1';
        }
        if (iframe) {
          iframe.style.visibility = 'hidden';
        }
      }
      
      // Function to update copyright year
      function updateCopyrightYear() {
        const currentYear = new Date().getFullYear();
        document.getElementById('copyrightYear').textContent = currentYear;
      }
      
      // Function to get Ghana time
      function getGhanaTime() {
        const now = new Date();
        const ghanaTime = new Date(now.toLocaleString('en-US', { timeZone: 'Africa/Accra' }));
        
        const hours = ghanaTime.getHours().toString().padStart(2, '0');
        const minutes = ghanaTime.getMinutes().toString().padStart(2, '0');
        const seconds = ghanaTime.getSeconds().toString().padStart(2, '0');
        
        return `${hours}:${minutes}:${seconds}`;
      }
      
      // Function to update Ghana time display
      function updateGhanaTime() {
        const ghanaTimeDisplay = document.getElementById('ghanaTimeDisplay');
        if (ghanaTimeDisplay) {
          ghanaTimeDisplay.textContent = getGhanaTime();
        }
      }
      
      // Function to start Ghana time updates
      function startGhanaTimeUpdates() {
        updateGhanaTime();
        ghanaTimeInterval = setInterval(updateGhanaTime, 1000);
      }
      
      // Function to stop Ghana time updates
      function stopGhanaTimeUpdates() {
        if (ghanaTimeInterval) {
          clearInterval(ghanaTimeInterval);
        }
      }
      
      // Function to validate login credentials
      function validateLogin(email, password) {
        const normalizedEmail = email.trim();
        const normalizedPassword = password.trim();
        
        const emailKey = Object.keys(userMap).find(key => 
          key.toLowerCase() === normalizedEmail.toLowerCase()
        );
        
        if (emailKey) {
          currentUserName = userMap[emailKey];
          currentUserEmail = emailKey;
          
          const isPasswordValid = normalizedPassword === correctPassword;
          
          return isPasswordValid;
        }
        
        return false;
      }
      
      // Function to handle failed login
      function handleFailedLogin() {
        failedAttempts++;
        const errorMessage = document.getElementById('errorMessage');
        const attemptsWarning = document.getElementById('attemptsWarning');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginButton = document.getElementById('loginButton');
        
        errorMessage.style.display = 'block';
        
        emailInput.classList.add('error');
        passwordInput.classList.add('error');
        
        passwordInput.value = '';
        emailInput.focus();
        
        if (failedAttempts >= 3) {
          attemptsWarning.style.display = 'block';
        }
        
        if (failedAttempts >= maxAttempts) {
          loginButton.disabled = true;
          loginButton.textContent = 'Access Temporarily Restricted';
          
          setTimeout(() => {
            loginButton.disabled = false;
            loginButton.textContent = 'Login';
            attemptsWarning.style.display = 'none';
            failedAttempts = 0;
          }, 30000);
        }
        
        setTimeout(() => {
          emailInput.classList.remove('error');
          passwordInput.classList.remove('error');
        }, 2000);
      }
      
      // Function to load the Tally form
      function loadTallyForm() {
        const iframe = document.getElementById('formIframe');
        if (iframe && iframe.dataset.tallySrc) {
          iframe.src = iframe.dataset.tallySrc;
          showLoading();
        } else {
          setTimeout(hideLoading, 3000);
        }
      }
      
      // Function to reset activity timers
      function resetActivityTimers() {
        lastActivityTime = Date.now();
        clearTimeout(inactivityTimer);
        clearTimeout(warningTimer);
        hideInactivityWarning();
        
        // Update session expiry
        updateSessionExpiry();
        
        // Set warning timer (after 1 minute)
        warningTimer = setTimeout(showInactivityWarning, WARNING_TIME);
        
        // Set inactivity timer (after 2 minutes)
        inactivityTimer = setTimeout(logoutDueToInactivity, SESSION_TIMEOUT);
      }
      
      // Function to show inactivity warning
      function showInactivityWarning() {
        document.getElementById('inactivityWarning').style.display = 'block';
        startInactivityCountdown(120); // 2 minutes
      }
      
      // Function to hide inactivity warning
      function hideInactivityWarning() {
        document.getElementById('inactivityWarning').style.display = 'none';
      }
      
      // Function to start inactivity countdown
      function startInactivityCountdown(seconds) {
        const timerElement = document.getElementById('inactivityTimer');
        let remaining = seconds;
        
        function updateTimer() {
          const minutes = Math.floor(remaining / 60);
          const secs = remaining % 60;
          timerElement.textContent = `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
          
          if (remaining <= 0) {
            clearInterval(countdownInterval);
          } else {
            remaining--;
          }
        }
        
        updateTimer();
        const countdownInterval = setInterval(updateTimer, 1000);
      }
      
      // Function to logout due to inactivity
      function logoutDueToInactivity() {
        showCustomAlert('Session Expired', 'Your session has expired due to inactivity. Please log in again.', 'info');
        logout();
      }
      
      // Function to show custom alert
      function showCustomAlert(title, message, type = 'info') {
        const icon = type === 'info' ? '‚ÑπÔ∏è' : type === 'warning' ? '‚ö†Ô∏è' : '‚ùå';
        
        const alertHTML = `
          <div class="confirmation-dialog">
            <div class="confirmation-icon">${icon}</div>
            <div class="confirmation-title">${title}</div>
            <div class="confirmation-message">${message}</div>
            <div class="confirmation-buttons">
              <button class="confirm-button confirm-no" id="closeAlert">OK</button>
            </div>
          </div>
        `;
        
        const overlay = document.getElementById('confirmationDialog');
        overlay.innerHTML = alertHTML;
        overlay.style.display = 'flex';
        
        document.getElementById('closeAlert').addEventListener('click', function() {
          overlay.style.display = 'none';
        });
      }
      
      // Function to track user activity
      function trackUserActivity() {
        resetActivityTimers();
      }
      
      // Function to check for existing session on page load
      function checkExistingSession() {
        const userSession = JSON.parse(localStorage.getItem(USER_SESSION_KEY) || '{}');
        
        if (userSession.email && userSession.name && userSession.sessionId) {
          // Check if session is still valid
          if (Date.now() < userSession.expiry) {
            const sessions = getActiveSessions();
            const activeSession = sessions[userSession.email];
            
            // Check if this is still the active session
            if (activeSession && activeSession.sessionId === userSession.sessionId) {
              currentUserEmail = userSession.email;
              currentUserName = userSession.name;
              setCurrentSessionId(userSession.sessionId);
              
              // Auto-login user WITHOUT showing greeting
              loadFormAfterLogin(false); // Pass false to indicate no greeting
              return true;
            }
          }
        }
        
        // Clear invalid session
        if (userSession.email) {
          removeUserSession(userSession.email);
        }
        
        return false;
      }
      
      // Function to update mobile UI elements
      function updateMobileUI() {
        const mobileUserName = document.getElementById('mobileUserName');
        const mobileUserNameShort = document.getElementById('mobileUserNameShort');
        
        if (currentUserName) {
          mobileUserName.textContent = `Logged in as: ${currentUserName}`;
          mobileUserNameShort.textContent = currentUserName.length > 10 ? 
            currentUserName.substring(0, 10) + '...' : currentUserName;
        }
      }
      
      // Function to handle back to top in iframe
      function scrollIframeToTop() {
        const iframe = document.getElementById('formIframe');
        
        // Try to access iframe content
        try {
          // If iframe is loaded and accessible
          if (iframe.contentWindow) {
            // Scroll iframe content to top
            iframe.contentWindow.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
            
            // Also try to scroll the iframe element itself
            iframe.scrollIntoView({
              behavior: 'smooth'
            });
          }
        } catch (e) {
          // If we can't access iframe content due to CORS, 
          // at least scroll the iframe into view
          iframe.scrollIntoView({
            behavior: 'smooth'
          });
        }
      }
      
      // Function to show form after successful login
      function loadFormAfterLogin(showGreeting = true) {
        document.getElementById('userNameDisplay').textContent = currentUserName;
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('formContainer').style.display = 'flex';
        
        // Update mobile UI
        updateMobileUI();
        
        // Show/hide footer based on screen size
        if (window.innerWidth > 768) {
          document.getElementById('siteFooter').style.display = 'flex';
        } else {
          document.getElementById('siteFooter').style.display = 'none';
        }
        
        startGhanaTimeUpdates();
        loadTallyForm();
        
        // Register user session
        const sessionId = registerUserSession(currentUserEmail, currentUserName);
        
        // Show greeting ONLY on first login (not on reloads)
        if (showGreeting) {
          showLoginGreeting();
        }
        
        // Start activity tracking
        resetActivityTimers();
        document.addEventListener('mousemove', trackUserActivity);
        document.addEventListener('keydown', trackUserActivity);
        document.addEventListener('click', trackUserActivity);
        document.addEventListener('scroll', trackUserActivity);
      }
      
      // Function to show logout notification
      function showLogoutNotification() {
        const notification = document.getElementById('logoutNotification');
        const countdownElement = document.getElementById('logoutCountdown');
        
        notification.style.display = 'flex';
        
        let countdown = 5;
        countdownElement.textContent = countdown;
        
        const countdownInterval = setInterval(() => {
          countdown--;
          countdownElement.textContent = countdown;
          
          if (countdown <= 0) {
            clearInterval(countdownInterval);
            notification.style.display = 'none';
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('siteFooter').style.display = 'none';
            
            // Hide mobile buttons
            document.getElementById('mobileLogoutButton').style.display = 'none';
            document.getElementById('mobileHeaderInfo').style.display = 'none';
            document.getElementById('mobileTopButton').style.display = 'none';
          }
        }, 1000);
      }
      
      // Function to logout
      function logout() {
        // Remove user session
        if (currentUserEmail) {
          removeUserSession(currentUserEmail);
        }
        
        // Clear timers
        clearTimeout(inactivityTimer);
        clearTimeout(warningTimer);
        hideInactivityWarning();
        stopGhanaTimeUpdates();
        
        // Remove activity listeners
        document.removeEventListener('mousemove', trackUserActivity);
        document.removeEventListener('keydown', trackUserActivity);
        document.removeEventListener('click', trackUserActivity);
        document.removeEventListener('scroll', trackUserActivity);
        
        // Hide modals
        document.getElementById('confirmationDialog').style.display = 'none';
        document.getElementById('loginGreeting').style.display = 'none';
        
        // Reset iframe
        const iframe = document.getElementById('formIframe');
        if (iframe) {
          iframe.src = '';
          iframe.style.visibility = 'hidden';
        }
        
        // Show loading overlay again
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) {
          loadingOverlay.style.display = 'flex';
          loadingOverlay.style.opacity = '1';
        }
        
        // Clear form
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        document.getElementById('email').focus();
        
        // Reset variables
        currentUserName = '';
        currentUserEmail = '';
        failedAttempts = 0;
        
        // Update mobile UI
        updateMobileUI();
        
        // Show logout notification
        showLogoutNotification();
      }
      
      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', function() {
        updateCopyrightYear();
        
        // Check for existing session
        if (checkExistingSession()) {
          console.log('Existing session found, auto-logging in (no greeting)...');
          return;
        }
        
        // Show login form
        document.getElementById('loginContainer').style.display = 'flex';
        document.getElementById('formContainer').style.display = 'none';
        document.getElementById('siteFooter').style.display = 'none';
        
        document.getElementById('email').focus();
        
        // Generate initial session ID
        if (!getCurrentSessionId()) {
          setCurrentSessionId(generateSessionId());
        }
      });
      
      // Handle login form submission
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('errorMessage');
        const attemptsWarning = document.getElementById('attemptsWarning');
        
        errorMessage.style.display = 'none';
        attemptsWarning.style.display = 'none';
        
        if (validateLogin(email, password)) {
          // Check if user is already logged in elsewhere
          if (isUserAlreadyLoggedIn(email)) {
            showCustomAlert('Multiple Login Detected', 
              'This account is already logged in on another device/browser. The other session will be logged out automatically.',
              'warning');
          }
          
          failedAttempts = 0;
          loadFormAfterLogin(true); // Pass true to show greeting on fresh login
        } else {
          handleFailedLogin();
        }
      });
      
      // Handle logout buttons
      document.getElementById('logoutButton').addEventListener('click', function() {
        document.getElementById('confirmationDialog').style.display = 'flex';
      });
      
      // Handle mobile logout button
      document.getElementById('mobileLogoutButton').addEventListener('click', function() {
        document.getElementById('confirmationDialog').style.display = 'flex';
      });
      
      // Handle mobile back to top button - FIXED
      document.getElementById('mobileTopButton').addEventListener('click', function(e) {
        e.stopPropagation(); // Prevent event bubbling
        e.preventDefault(); // Prevent default behavior
        
        // Call the function to scroll iframe to top
        scrollIframeToTop();
        
        // Add visual feedback
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
          this.style.transform = 'scale(1)';
        }, 200);
        
        return false;
      });
      
      // Handle confirmation dialog buttons
      document.getElementById('confirmLogout').addEventListener('click', function() {
        logout();
      });
      
      document.getElementById('cancelLogout').addEventListener('click', function() {
        document.getElementById('confirmationDialog').style.display = 'none';
      });
      
      // Handle keep active button
      document.getElementById('keepActiveButton').addEventListener('click', function() {
        resetActivityTimers();
      });
      
      // Close confirmation dialog when clicking outside
      document.getElementById('confirmationDialog').addEventListener('click', function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      });
      
      // Clear input errors on focus
      document.getElementById('email').addEventListener('focus', function() {
        this.classList.remove('error');
      });
      
      document.getElementById('password').addEventListener('focus', function() {
        this.classList.remove('error');
      });
      
      // Add keypress event for Enter key
      document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          document.getElementById('loginForm').dispatchEvent(new Event('submit'));
        }
      });
      
      // Handle window resize to show/hide footer appropriately
      window.addEventListener('resize', function() {
        if (currentUserName) {
          if (window.innerWidth > 768) {
            document.getElementById('siteFooter').style.display = 'flex';
            document.getElementById('mobileLogoutButton').style.display = 'none';
            document.getElementById('mobileHeaderInfo').style.display = 'none';
            document.getElementById('mobileTopButton').style.display = 'none';
          } else {
            document.getElementById('siteFooter').style.display = 'none';
            document.getElementById('mobileLogoutButton').style.display = 'block';
            document.getElementById('mobileHeaderInfo').style.display = 'block';
            
            // Show back to top button if scrolled
            if (window.scrollY > 300) {
              document.getElementById('mobileTopButton').style.display = 'flex';
            }
          }
        }
      });
      
      // Periodically check session status
      setInterval(function() {
        if (currentUserEmail) {
          const userSession = JSON.parse(localStorage.getItem(USER_SESSION_KEY) || '{}');
          const sessions = getActiveSessions();
          const activeSession = sessions[currentUserEmail];
          
          // Check if session was removed (logged out from elsewhere)
          if (!activeSession || activeSession.sessionId !== userSession.sessionId) {
            showCustomAlert('Session Ended', 
              'Your session was ended because you logged in from another device/browser.',
              'info');
            logout();
          }
        }
      }, 30000); // Check every 30 seconds
      
      // Clean up old greeting records periodically (optional)
      function cleanOldGreetingRecords() {
        const shownGreetings = JSON.parse(localStorage.getItem(SHOWN_GREETING_KEY) || '{}');
        const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000); // 1 week
        
        // Extract session IDs and their timestamps
        Object.keys(shownGreetings).forEach(sessionId => {
          const timestamp = parseInt(sessionId.split('_')[1]);
          if (timestamp && timestamp < oneWeekAgo) {
            delete shownGreetings[sessionId];
          }
        });
        
        localStorage.setItem(SHOWN_GREETING_KEY, JSON.stringify(shownGreetings));
      }
      
      // Run cleanup once a day
      setInterval(cleanOldGreetingRecords, 24 * 60 * 60 * 1000);
      cleanOldGreetingRecords(); // Run on initial load
      
      // Show/hide back to top button based on scroll position
      window.addEventListener('scroll', function() {
        const mobileTopButton = document.getElementById('mobileTopButton');
        if (currentUserName && window.innerWidth <= 768) {
          if (window.scrollY > 300) {
            mobileTopButton.style.display = 'flex';
          } else {
            mobileTopButton.style.display = 'none';
          }
        }
      });
      
      // Add click event to ensure mobile buttons are clickable
      document.addEventListener('click', function(e) {
        // If clicking on mobile logout button
        if (e.target.closest('#mobileLogoutButton')) {
          e.stopPropagation();
          e.preventDefault();
          document.getElementById('confirmationDialog').style.display = 'flex';
          return false;
        }
        
        // If clicking on mobile top button
        if (e.target.closest('#mobileTopButton')) {
          e.stopPropagation();
          e.preventDefault();
          scrollIframeToTop();
          return false;
        }
      }, true); // Use capture phase to ensure we catch the event
    </script>
  </body>
</html>
